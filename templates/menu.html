<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メニュー</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; }
        .card { margin-bottom: 1.5rem; }
        .btn-full { width: 100%; margin-bottom: 0.5rem; }
        .resume-text { font-size: 0.9rem; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-4">
            <h1 class="h2 mb-3 mb-md-0">単語学習メニュー</h1>
            <div class="text-center text-md-end">
                <p class="me-md-3 mb-2 mb-md-0 d-block d-md-inline">ようこそ, {{ current_user.nickname }} さん</p>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('mypage') }}" class="btn btn-sm btn-outline-primary">マイページ</a>
                    {% if current_user.is_admin %}
                        <a href="{{ url_for('admin_page') }}" class="btn btn-sm btn-danger">管理者ページ</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-secondary">ログアウト</a>
                </div>
            </div>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-info">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-info">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">出題形式を選択</h5>
                <div class="btn-group w-100" role="group">
                    {% set current_direction = session.get('quiz_direction', 'ej') %}
                    <a href="{{ url_for('set_direction', direction='ej') }}" class="btn {% if current_direction == 'ej' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        英語 → 日本語
                    </a>
                    <a href="{{ url_for('set_direction', direction='je') }}" class="btn {% if current_direction == 'je' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        日本語 → 英語
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <!-- (ランダムで学ぶカード) -->
            </div>
            <!-- ... 他のカード ... -->
        </div>
        <div class="row">
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">🚀 ランダムで学ぶ</h5>
                        <p class="card-text">全ての単語からランダムに出題されます。</p>
                        <div class="mt-auto">
                            {% if saved_random_state %}
                                <p class="resume-text">💡 中断したデータがあります</p>
                                <a href="{{ url_for('resume_random_quiz') }}" class="btn btn-success btn-full">途中から学ぶ</a>
                                <a href="{{ url_for('start_new_random_quiz') }}" class="btn btn-primary btn-full">新しく学ぶ</a>
                            {% else %}
                                <a href="{{ url_for('start_new_random_quiz') }}" class="btn btn-primary btn-full">クイズ開始</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">📚 細かく学ぶ</h5>
                        <p class="card-text">範囲を選んで集中的に学習します。</p>
                        <div class="mt-auto">
                            <a href="{{ url_for('learn_details') }}" class="btn btn-primary btn-full">範囲を選択する</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">💪 間違えた問題を復習</h5>
                        <p class="card-text">間違えた問題に再挑戦して記憶を定着。</p>
                        <div class="mt-auto">
                            {% if saved_review_state %}
                                <p class="resume-text">💡 中断したデータがあります</p>
                                <a href="{{ url_for('retry_mistakes') }}" class="btn btn-success btn-full">途中から復習</a>
                            {% endif %}
                            <a href="{{ url_for('retry_mistakes') }}" class="btn btn-warning btn-full">
                                {% if saved_review_state %}新しく復習を始める{% else %}復習を開始{% endif %}
                            </a>
                            <a href="{{ url_for('manage_mistakes') }}" class="btn btn-outline-secondary btn-full mt-2">
                                間違いリストを管理
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">🏆 週間学習ランキング Top 3</h5>
                {% if top_users %}
                    <ul class="list-group list-group-flush">
                        {% for user, attempts in top_users %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                {% if loop.index == 1 %}🥇{% elif loop.index == 2 %}🥈{% elif loop.index == 3 %}🥉{% else %}{{ loop.index }}.{% endif %}
                                {{ user.nickname }} さん
                            </span>
                            <span class="badge bg-primary rounded-pill">{{ attempts }} 問</span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">まだランキングデータがありません。</p>
                {% endif %}
            </div>
        </div>
        <!-- ★★★ ここまで ★★★ -->
        <!-- menu.html の <div class="row"> の中に追加 -->

        <div class="card mb-4">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">⚙️ ツール・分析</h5>
                    <p class="card-text">便利な機能で学習をサポートします。</p>
                    <div class="mt-auto">
                        <a href="{{ url_for('search_word') }}" class="btn btn-info btn-full">単語を検索する</a>
                        <a href="{{ url_for('progress') }}" class="btn btn-info btn-full">進捗グラフを見る</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <a href="{{ url_for('start_fresh_quiz_from_anywhere') }}" class="btn btn-danger" onclick="return confirm('本当に全ての進行状況と間違いリストをリセットしますか？');">全てのデータをリセット</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>