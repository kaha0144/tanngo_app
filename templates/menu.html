<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 960px; }
        .card { transition: transform 0.2s ease-in-out; }
        .card:hover { transform: translateY(-5px); }
        .resume-text { font-size: 0.9rem; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-5">
            <h1 class="h2 mb-3 mb-md-0">å˜èªå­¦ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>
            <div class="text-center text-md-end">
                <p class="me-md-3 mb-2 mb-md-0 d-block d-md-inline">ã‚ˆã†ã“ã, {{ current_user.nickname }} ã•ã‚“</p>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('mypage') }}" class="btn btn-sm btn-outline-primary">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                    <a href="{{ url_for('contact') }}" class="btn btn-sm btn-outline-primary">
                        ãŠå•ã„åˆã‚ã›
                    </a>
                    {% if current_user.is_admin %}
                        <a href="{{ url_for('admin_page') }}" class="btn btn-sm btn-danger">ç®¡ç†è€…ãƒšãƒ¼ã‚¸</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-secondary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                </div>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-info" role="alert">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="card mb-5 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title mb-3">1. ã¾ãšã¯å‡ºé¡Œå½¢å¼ã‚’é¸æŠ</h5>
                <div class="btn-group w-100" role="group">
                    {% set current_direction = session.get('quiz_direction', 'ej') %}
                    <a href="{{ url_for('set_direction', direction='ej') }}" class="btn {% if current_direction == 'ej' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        è‹±èª â†’ æ—¥æœ¬èª
                    </a>
                    <a href="{{ url_for('set_direction', direction='je') }}" class="btn {% if current_direction == 'je' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        æ—¥æœ¬èª â†’ è‹±èª
                    </a>
                </div>
            </div>
        </div>

        <h2 class="h4 mb-3">2. å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã¶</h2>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mb-5">
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="bi bi-shuffle text-primary"></i> ãƒ©ãƒ³ãƒ€ãƒ ã§å­¦ã¶</h5>
                        <p class="card-text small">å…¨å˜èªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œ</p>
                        <div class="mt-auto pt-2">
                            {% if saved_random_state %}
                                <p class="resume-text">ğŸ’¡ ä¸­æ–­ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š</p>
                                <a href="{{ url_for('resume_random_quiz') }}" class="btn btn-success w-100 mb-2">é€”ä¸­ã‹ã‚‰</a>
                                <a href="{{ url_for('start_new_random_quiz') }}" class="btn btn-primary w-100">æ–°ã—ã</a>
                            {% else %}
                                <a href="{{ url_for('start_new_random_quiz') }}" class="btn btn-primary w-100">ã‚¹ã‚¿ãƒ¼ãƒˆ</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="bi bi-lightning-charge text-success"></i> ã–ã£ãã‚Šå­¦ã¶</h5>
                        <p class="card-text small">æ°—è»½ã«å…¨ä½“ã‚’æŠŠæ¡ã—ã¾ã™ã€‚</p>
                        <div class="mt-auto pt-2">
                            <a href="{{ url_for('rough_range_selector', direction=session.get('quiz_direction', 'ej')) }}" class="btn btn-info w-100 mb-2">
                                <i class="bi bi-collection"></i> ç´°ã‹ãå­¦ã¶
                            </a>
                            <a href="{{url_for('start_rough_review')}}" class="btn btn-warning w-100">
                                <i class="bi bi-arrow-counterclockwise"></i> é–“é•ã„ã‚’å¾©ç¿’
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="bi bi-arrow-counterclockwise text-warning"></i> ç·åˆå¾©ç¿’</h5>
                        <p class="card-text small">å…¨ã¦ã®é–“é•ã„ã«å†æŒ‘æˆ¦ã—ã¾ã™ã€‚</p>
                        <div class="mt-auto pt-2">
                            {% if saved_review_state %}
                                <p class="resume-text text-center mb-2">ğŸ’¡ ä¸­æ–­ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™</p>
                                <!-- ã€Œé€”ä¸­ã‹ã‚‰ã€ãƒœã‚¿ãƒ³: ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ã‹ã‚‰å†é–‹ã—ã¾ã™ -->
                                <a href="{{ url_for('retry_mistakes') }}" class="btn btn-success w-100 mb-2">é€”ä¸­ã‹ã‚‰å¾©ç¿’</a>
                                <!-- ã€Œæ–°ã—ãã€ãƒœã‚¿ãƒ³: ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ç ´æ£„ã—ã¦æœ€åˆã‹ã‚‰å§‹ã‚ã¾ã™ -->
                                <a href="{{ url_for('retry_mistakes', new=True) }}" class="btn btn-warning w-100">æ–°ã—ãå¾©ç¿’</a>
                            {% else %}
                                <!-- ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ãŒãªã„å ´åˆ -->
                                <a href="{{ url_for('retry_mistakes') }}" class="btn btn-warning w-100">å¾©ç¿’é–‹å§‹</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="bi bi-collection text-info"></i> ç·åˆå­¦ç¿’</h5>
                        <p class="card-text small">å…¨ç¯„å›²ã‹ã‚‰é›†ä¸­çš„ã«å­¦ç¿’</p>
                        <div class="mt-auto pt-2">
                            <a href="{{ url_for('learn_details') }}" class="btn btn-primary w-100">ç¯„å›²ã‚’é¸æŠ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="h4 mb-3">3. å­¦ç¿’ã®è¨˜éŒ²ã¨ãƒ„ãƒ¼ãƒ«</h2>
        <div class="row row-cols-1 row-cols-lg-2 g-4 mb-5">
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-trophy"></i> é€±é–“å­¦ç¿’ãƒ©ãƒ³ã‚­ãƒ³ã‚° Top 3</h5>
                        {% if top_users %}
                            <ul class="list-group list-group-flush">
                                {% for user, attempts in top_users %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>
                                        {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}.{% endif %}
                                        {{ user.nickname }} ã•ã‚“
                                    </span>
                                    <span class="badge bg-primary rounded-pill">{{ attempts }} å•</span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">ã¾ã ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="bi bi-tools"></i> ãƒ„ãƒ¼ãƒ«ã¨åˆ†æ</h5>
                        <div class="mt-auto pt-2">
                            <a href="{{ url_for('search_word') }}" class="btn btn-outline-info w-100 mb-2">å˜èªã‚’æ¤œç´¢ã™ã‚‹</a>
                            <a href="{{ url_for('progress') }}" class="btn btn-outline-info w-100 mb-2">é€²æ—ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹</a>
                             <a href="{{ url_for('all_manage_mistakes') }}" class="btn btn-outline-secondary w-100">å…¨ã¦ã®é–“é•ã„ã‚’ç®¡ç†</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-danger mt-5 shadow-sm">
            <div class="card-header bg-danger text-white">
                <i class="bi bi-exclamation-triangle-fill"></i> å…¨ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚»ãƒƒãƒˆ
            </div>
            <div class="card-body text-center">
                <p class="card-text text-danger mb-3">æ³¨æ„: å…¨ã¦ã®é€²è¡ŒçŠ¶æ³ã¨é–“é•ã„ãƒªã‚¹ãƒˆãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</p>
                <a href="{{ url_for('start_fresh_quiz_from_anywhere') }}" class="btn btn-danger" onclick="return confirm('æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿå…¨ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚');">
                    å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>