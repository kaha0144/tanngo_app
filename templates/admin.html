{% extends "base.html" %}
{% block content %}
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ç®¡ç†è€…ãƒšãƒ¼ã‚¸</h2>
    <a href="{{ url_for('menu') }}" class="btn btn-primary">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
  </div>

  <div class="card mb-5">
    <div class="card-header">
      <h4>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h4>
    </div>
    <div class="card-body">
      <form action="{{ url_for('admin_page') }}" method="post">
        <div class="mb-3">
          <label for="username" class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼å (ãƒ­ã‚°ã‚¤ãƒ³ID)</label>
          <input type="text" class="form-control" id="username" name="username" required>
        </div>
        <div class="mb-3">
          <label for="nickname" class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  (è¡¨ç¤ºå)</label>
          <input type="text" class="form-control" id="nickname" name="nickname" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="is_admin" name="is_admin">
          <label class="form-check-label" for="is_admin">ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹</label>
        </div>
        <button type="submit" class="btn btn-success">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ</button>
      </form>
    </div>
  </div>

  <h3 class="mt-5">ğŸ‘¥ ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h3>
    <ul class="list-group mb-5">
    {% for user in all_users %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
        
        <div>
            <strong>{{ user.nickname }}</strong> (ãƒ­ã‚°ã‚¤ãƒ³ID: {{ user.username }})
            {% if user.is_admin %}
            <span class="badge bg-danger">ç®¡ç†è€…</span>
            {% else %}
            <span class="badge bg-secondary">ä¸€èˆ¬</span>
            {% endif %}
        </div>
        
        <div class="d-flex align-items-center">
            <span class="badge bg-info me-3">é€±é–“è§£ç­”: {{ user.weekly_attempts }} å•</span>
        {# è‡ªåˆ†è‡ªèº«ã§ã¯ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã®ã¿å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º #}
            {% if user.id != current_user.id %}
            <form action="{{ url_for('delete_user', user_id=user.id) }}" method="post" onsubmit="return confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å…¨ã¦ã®é–¢é€£ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');" style="display: inline;">
                <button type="submit" class="btn btn-danger btn-sm">å‰Šé™¤</button>
            </form>
            {% endif %}
        </div>
        
        </li>
    {% endfor %}
    </ul>

  <h3 class="mt-5">é€±é–“å­¦ç¿’ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
  <ul class="list-group mb-5">
    {% for user_stat in user_stats %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        {# statã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®Userãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰æƒ…å ±ã‚’å–å¾— #}
        {{ user_stat.User.nickname }} ({{ user_stat.User.username }})
        <span class="badge bg-primary rounded-pill">{{ user_stat.weekly_attempts }} å•</span>
    </li>
    {% endfor %}
  </ul>

  <h3 class="mt-5 d-flex justify-content-between align-items-center">
    <span>ğŸ“¨ ãŠå•ã„åˆã‚ã›ä¸€è¦§</span>
    <a href="{{ url_for('deleted_messages_page') }}" class="btn btn-secondary btn-sm">
        å‰Šé™¤æ¸ˆã¿ãƒªã‚¹ãƒˆã‚’è¦‹ã‚‹
    </a>
  </h3>
  {% if contact_msgs and contact_msgs|length > 0 %}
    <ul class="list-group">
      {% for msg in contact_msgs %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <strong>{{ msg.user.nickname }} ({{ msg.user.username }})</strong>
            <small class="text-muted">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
          </div>
          <div class="mt-2">
            <strong>ä»¶å:</strong> {{ msg.subject }}<br>
            <strong>å†…å®¹:</strong>
            <p>{{ msg.body.replace('\n','<br>')|safe }}</p>
          </div>
          <div class="text-end mt-2">
            <form action="{{ url_for('delete_message', msg_id=msg.id) }}" method="post" onsubmit="return confirm('æœ¬å½“ã«ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
              <button type="submit" class="btn btn-danger btn-sm">å‰Šé™¤</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">ãŠå•ã„åˆã‚ã›ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

</div>
{% endblock %}